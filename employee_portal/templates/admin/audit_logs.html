{% extends "base.html" %}
{% block content %}
<div class="container-fluid py-4">
    <div class="mb-4">
        <h3 class="fw-bold text-dark">Audit Logs</h3>
        <p class="text-muted small">System-wide activity and security tracking.</p>
    </div>

    <!-- Filter Card -->
    <div class="card border-0 shadow-sm rounded-4 mb-4" style="border: 1px solid #e2e8f0 !important;">
        <div class="card-body p-4">
            <form method="GET" action="{{ url_for('admin.audit_logs') }}" class="row g-3 align-items-end">
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-secondary text-uppercase">Date</label>
                    <input type="date" name="date" class="form-control shadow-none border-light bg-light rounded-3" value="{{ date_filter }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-secondary text-uppercase">Action</label>
                    <select name="action" class="form-select shadow-none border-light bg-light rounded-3">
                        <option value="">All Actions</option>
                        {% for action in action_list %}
                        <option value="{{ action }}" {% if action_filter == action %}selected{% endif %}>{{ action }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label small fw-semibold text-secondary text-uppercase">Performed By</label>
                    <input type="text" name="user" class="form-control shadow-none border-light bg-light rounded-3" placeholder="Name or Email" value="{{ user_filter }}">
                </div>
                <div class="col-md-3 d-flex gap-2">
                    <button type="submit" class="btn btn-primary rounded-pill px-4 fw-bold shadow-sm flex-grow-1">
                        <i class="bi bi-filter me-2"></i>Filter
                    </button>
                    <a href="{{ url_for('admin.audit_logs') }}" class="btn btn-light rounded-pill px-4 fw-bold shadow-sm border flex-grow-1 text-center">Reset</a>
                </div>
            </form>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4" style="border: 1px solid #e2e8f0 !important;">
        <div class="card-header bg-white py-3 border-0 rounded-top-4" style="border-left: 4px solid #e67e22 !important;">
            <h6 class="m-0 fw-semibold text-dark"><i class="bi bi-activity me-2 text-primary"></i>System Activities</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light text-muted extra-small text-uppercase">
                        <tr>
                            <th class="ps-4">Timestamp</th>
                            <th>Action</th>
                            <th>Resource</th>
                            <th>Details</th>
                            <th class="pe-4">Performed By</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs.items %}
                        <tr>
                            <td class="ps-4 small fw-medium text-dark">{{ log.timestamp.strftime('%d %b %Y %H:%M') }}</td>
                            <td>
                                <span class="badge rounded-pill bg-{% if log.action == 'DELETE' %}danger{% elif log.action == 'UPDATE' %}warning{% else %}success{% endif %} bg-opacity-10 text-{% if log.action == 'DELETE' %}danger{% elif log.action == 'UPDATE' %}warning{% else %}success{% endif %} px-2 extra-small">
                                    {{ log.action }}
                                </span>
                            </td>
                            <td class="small">{{ log.resource_type }}</td>
                            <td class="small text-muted">{{ log.details }}</td>
                            <td class="pe-4 small fw-semibold text-dark">{{ log.performed_by }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div class="p-3 border-top">
                <nav aria-label="Page navigation">
                    <ul class="pagination pagination-sm justify-content-center mb-0">
                        {% if logs.has_prev %}
                        <li class="page-item">
                            <a class="page-link shadow-none border-light rounded-start-pill px-3" href="{{ url_for('admin.audit_logs', page=logs.prev_num, date=date_filter, action=action_filter, user=user_filter) }}">Previous</a>
                        </li>
                        {% endif %}

                        {% for page_num in logs.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                            {% if page_num %}
                                <li class="page-item {% if logs.page == page_num %}active{% endif %}">
                                    <a class="page-link shadow-none border-light {% if logs.page == page_num %}bg-primary border-primary{% endif %}" href="{{ url_for('admin.audit_logs', page=page_num, date=date_filter, action=action_filter, user=user_filter) }}">{{ page_num }}</a>
                                </li>
                            {% else %}
                                <li class="page-item disabled"><span class="page-link border-light">...</span></li>
                            {% endif %}
                        {% endfor %}

                        {% if logs.has_next %}
                        <li class="page-item">
                            <a class="page-link shadow-none border-light rounded-end-pill px-3" href="{{ url_for('admin.audit_logs', page=logs.next_num, date=date_filter, action=action_filter, user=user_filter) }}">Next</a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<style>
    .extra-small { font-size: 0.7rem; }
    .rounded-top-4 { border-top-left-radius: 12px !important; border-top-right-radius: 12px !important; }
</style>
{% endblock %}