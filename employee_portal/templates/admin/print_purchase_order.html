<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Order #{{ po.po_number }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #525659; }
        .page {
            background: white;
            width: 21cm;
            min-height: 29.7cm;
            margin: 2cm auto;
            padding: 2cm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        @media print {
            @page { margin: 0; size: auto; }
            html, body { height: auto; }
            body { background: white; margin: 0; -webkit-print-color-adjust: exact; }
            .page { width: 100%; height: auto; min-height: auto; margin: 0; padding: 1.5cm; box-shadow: none; border: none; }
            .no-print { display: none !important; }
        }
        .header-logo { height: 60px; }
        .po-title { color: #e67e22; font-weight: bold; letter-spacing: 1px; }
        .table-items th { background-color: #f8f9fa !important; border-bottom: 2px solid #e67e22; font-size: 0.85rem; text-transform: uppercase; color: #495057; }
        .table-items td { vertical-align: middle; }
        .footer-note { font-size: 0.8rem; color: #6c757d; }
    </style>
</head>
<body>

    <div class="container py-3 no-print text-center">
        <button onclick="window.print()" class="btn btn-primary rounded-pill px-4 shadow-sm" style="background-color: #e67e22; border-color: #e67e22;"><i class="bi bi-printer me-2"></i>Print Purchase Order</button>
        <button onclick="window.close()" class="btn btn-outline-light rounded-pill px-4 ms-2">Close</button>
    </div>

    <div class="page">
        <!-- Header -->
        <div class="d-flex justify-content-between align-items-start mb-5">
            <img src="{{ url_for('static', filename='img/logo.PNG') }}" alt="Gentize Logo" class="header-logo">
            <div class="text-end">
                <h2 class="po-title mb-0">PURCHASE ORDER</h2>
                <div class="text-muted small mt-1">PO #: <span class="fw-bold text-dark">{{ po.po_number }}</span></div>
                <div class="text-muted small">Date: {{ po.date.strftime('%d %b %Y') }}</div>
            </div>
        </div>

        <!-- Addresses -->
        <div class="row mb-5">
            <div class="col-6">
                <h6 class="text-uppercase text-secondary small fw-bold mb-2">Vendor:</h6>
                <div class="fw-bold">{{ po.vendor.name }}</div>
                <div class="small text-muted">
                    {{ po.vendor.address or '' }}<br>
                    {% if po.vendor.contact_person %}Contact: {{ po.vendor.contact_person }}<br>{% endif %}
                    {% if po.vendor.email %}Email: {{ po.vendor.email }}<br>{% endif %}
                    {% if po.vendor.gstin %}GSTIN: {{ po.vendor.gstin }}{% endif %}
                </div>
            </div>
            <div class="col-6 text-end">
                <h6 class="text-uppercase text-secondary small fw-bold mb-2">Ship To:</h6>
                <div class="fw-bold">Gentize Innovation Pvt Ltd</div>
                <div class="small text-muted">
                    No.9, 2nd Floor, Saravana Complex<br>
                    Service Road, Paraniputhur<br>
                    Chennai - 600128, Tamil Nadu, India<br>
                    PH: +91 7200990203<br>
                    Email: info@gentizeinnovations.com<br>
                    GSTIN: 33AALCG9811F1ZL
                </div>
            </div>
        </div>

        <!-- Items Table -->
        <table class="table table-items mb-4">
            <thead>
                <tr>
                    <th style="width: 50%;">Item / Description</th>
                    <th class="text-center" style="width: 15%;">Qty</th>
                    <th class="text-end" style="width: 15%;">Price</th>
                    <th class="text-end" style="width: 20%;">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td>
                        <div class="fw-semibold">{{ item.get('item', item) or '-' }}</div>
                    </td>
                    <td class="text-center">{{ item.get('qty') or '-' }}</td>
                    <td class="text-end">
                        {% if item.get('price') %}₹{{ item.get('price') }}{% else %}-{% endif %}
                    </td>
                    <td class="text-end">
                         {% if item.get('total') %}
                            ₹{{ item.get('total') }}
                         {% elif item.get('price') and item.get('qty') and item.get('qty')|float %}
                            ₹{{ (item.get('price')|float * item.get('qty')|float)|round(2) }}
                         {% else %}-{% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" class="text-end fw-bold pt-3">Subtotal</td>
                    <td class="text-end fw-bold pt-3">
                        {% set ns = namespace(subtotal=0) %}
                        {% for item in items %}
                            {% if item.get('total') %}
                                {% set ns.subtotal = ns.subtotal + item.get('total')|float %}
                            {% elif item.get('price') and item.get('qty') %}
                                {% set ns.subtotal = ns.subtotal + (item.get('price')|float * item.get('qty')|float) %}
                            {% endif %}
                        {% endfor %}
                        ₹{{ "%.2f"|format(ns.subtotal) }}
                    </td>
                </tr>
                <tr>
                    <td colspan="3" class="text-end border-0 pt-1 pb-1 small text-muted">Tax ({{ po.tax_percentage or 0 }}%)</td>
                    <td class="text-end border-0 pt-1 pb-1 small text-muted">
                        {% set tax_amt = ns.subtotal * (po.tax_percentage or 0) / 100 %}
                        ₹{{ "%.2f"|format(tax_amt) }}
                    </td>
                </tr>
                 <tr>
                    <td colspan="3" class="text-end border-0 pt-3"><h5 class="fw-bold m-0 text-primary" style="color: #e67e22 !important;">Total</h5></td>
                    <td class="text-end border-0 pt-3"><h5 class="fw-bold m-0 text-primary" style="color: #e67e22 !important;">₹{{ "%.2f"|format(ns.subtotal + tax_amt) }}</h5></td>
                </tr>
            </tfoot>
        </table>

        <!-- Notes -->
        {% if po.notes %}
        <div class="mb-5">
            <h6 class="text-uppercase text-secondary small fw-bold mb-2">Notes:</h6>
            <div class="small text-muted p-3 bg-light rounded">{{ po.notes }}</div>
        </div>
        {% endif %}

        <!-- Authorization -->
        <div class="row mt-auto pt-5">
            <div class="col-8">
                <div class="footer-note">
                    <p class="mb-1 fw-bold">Terms & Conditions:</p>
                    <ol class="ps-3 mb-0">
                        <li>Payment terms are Net 30 days upon receipt of invoice.</li>
                        <li>Please include PO number on all invoices and packages.</li>
                    </ol>
                </div>
            </div>
            <div class="col-4 text-center">
                <div class="mb-2" style="height: 60px;">
                    {% if po.signature %}
                        <img src="{{ url_for('static', filename='img/' + po.signature.file_path) }}" alt="Signature" style="max-height: 100%; max-width: 100%;">
                    {% endif %}
                </div>
                <div class="border-bottom border-dark mb-2"></div>
                <div class="small fw-bold">Authorized Signature</div>
                {% if po.signature %}
                    <div class="extra-small text-muted">{{ po.signature.name }}</div>
                {% endif %}
            </div>
        </div>
    </div>

</body>
</html>