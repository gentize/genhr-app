{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Data Management</h1>
    </div>

    <div class="row">
        <!-- Clear Records Section -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-danger text-white">
                    <h5 class="card-title mb-0"><i class="bi bi-trash me-2"></i>Clear Records</h5>
                </div>
                <div class="card-body">
                    <p class="card-text text-muted">Select a table to delete ALL records from it. This action cannot be undone.</p>
                    <form action="{{ url_for('admin.clear_table') }}" method="POST" onsubmit="return confirm('Are you sure you want to delete all records from this table? This cannot be undone.');">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <div class="mb-3">
                            <label for="table_name" class="form-label">Select Table</label>
                            <select class="form-select" id="table_name" name="table_name" required>
                                <option value="" selected disabled>Choose table...</option>
                                <optgroup label="Transactional Data">
                                    <option value="Attendance">Attendance</option>
                                    <option value="Leave">Leave Requests</option>
                                    <option value="ExpenseClaim">Expense Claims</option>
                                    <option value="Payroll">Payroll</option>
                                    <option value="Task">Tasks (Master)</option>
                                    <option value="EmployeeTask">Employee Tasks (Instances)</option>
                                    <option value="AuditLog">Audit Logs</option>
                                    <option value="AssetHistory">Asset History</option>
                                    <option value="Credit">Credits</option>
                                    <option value="Debit">Debits</option>
                                    <option value="Invoice">Invoices</option>
                                    <option value="PurchaseOrder">Purchase Orders</option>
                                    <option value="BillEstimate">Bill Estimates</option>
                                    <option value="ShiftSchedule">Shift Schedules</option>
                                </optgroup>
                                <optgroup label="Recruitment">
                                    <option value="JobOpening">Job Openings</option>
                                    <option value="Candidate">Candidates</option>
                                </optgroup>
                                <optgroup label="Performance">
                                    <option value="Appraisal">Appraisals</option>
                                </optgroup>
                                <optgroup label="Core Data (Danger Zone)">
                                    <option value="Vendor">Vendors</option>
                                    <option value="Asset">Assets</option>
                                    <option value="Holiday">Holidays</option>
                                    <option value="Announcement">Announcements</option>
                                </optgroup>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-danger w-100">Clear Records</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Backup & Restore Section -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0"><i class="bi bi-database-fill-gear me-2"></i>Backup & Restore</h5>
                </div>
                <div class="card-body">
                    <!-- Backup -->
                    <div class="mb-4">
                        <h6>Backup Database</h6>
                        <p class="text-muted small">Download a copy of the current database (SQLite file).</p>
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('admin.backup_database') }}" class="btn btn-outline-primary">
                                <i class="bi bi-download me-2"></i>Download Database Only
                            </a>
                            <a href="{{ url_for('admin.backup_full') }}" class="btn btn-primary">
                                <i class="bi bi-file-earmark-zip me-2"></i>Download Full Backup (Include Files)
                            </a>
                        </div>
                    </div>

                    <hr>

                    <!-- Restore -->
                    <div>
                        <h6>Restore Database</h6>
                        <p class="text-muted small">Upload a valid SQLite database file to restore. The current database will be backed up automatically before replacement.</p>
                        <form action="{{ url_for('admin.restore_database') }}" method="POST" enctype="multipart/form-data" onsubmit="return confirm('Are you sure you want to restore the database? Current data will be replaced.');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <div class="mb-3">
                                <label for="backup_file" class="form-label">Select Backup File (.db)</label>
                                <input class="form-control" type="file" id="backup_file" name="backup_file" accept=".db" required>
                            </div>
                            <button type="submit" class="btn btn-warning w-100">
                                <i class="bi bi-upload me-2"></i>Restore Database
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
