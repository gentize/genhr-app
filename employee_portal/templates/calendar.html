{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div class="mb-4">
        <h3 class="fw-bold text-dark">Company Calendar</h3>
        <p class="text-muted small">Overview of company holidays and schedule.</p>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden mx-auto" style="border: 1px solid #e2e8f0 !important; max-width: 600px;">
        <div class="card-header bg-white py-3 border-0 rounded-top-4 d-flex justify-content-between align-items-center" style="border-left: 4px solid #e67e22 !important;">
            <h6 class="m-0 fw-semibold text-dark"><i class="bi bi-calendar3 me-2 text-primary"></i>Holiday Schedule</h6>
            <div id="calMonthLabel" class="small fw-bold text-primary text-uppercase" style="letter-spacing: 1px;"></div>
        </div>
        <div class="card-body p-3">
            <div id="fullCalendar"></div>
        </div>
    </div>
</div>

<style>
    /* Modern Enterprise Calendar Styles */
    .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; }
    .cal-day-head { text-align: center; font-weight: 700; color: #94a3b8; text-transform: uppercase; font-size: 0.6rem; padding: 10px 0; }
    .cal-day { min-height: 60px; padding: 6px; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
    .cal-day.today .cal-num { background: #fff7ed; color: #e67e22; border: 1.5px solid #fdba74; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
    .cal-day.holiday { background: #fff5f5; }
    .cal-day.sunday { background: #f8fafc; }
    .cal-day.other-month { visibility: hidden; }
    .cal-num { font-size: 0.85rem; font-weight: 600; color: #475569; }
    .holiday-indicator { width: 4px; height: 4px; background: #ef4444; border-radius: 50%; margin-top: 4px; }
    .off-label { font-size: 0.5rem; color: #94a3b8; margin-top: 2px; }
    .cal-btn { width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: #f1f5f9; color: #64748b; border: none; transition: 0.2s; }
    .cal-btn:hover { background: #e2e8f0; color: #334155; }
    .rounded-top-4 { border-top-left-radius: 12px !important; border-top-right-radius: 12px !important; }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        let month = new Date().getMonth();
        let year = new Date().getFullYear();
        let holidays = [];

        async function init() {
            try {
                const response = await fetch('{{ url_for("main.get_holidays_api") }}');
                holidays = await response.json();
                render(month, year);
            } catch (err) { render(month, year); }
        }

        function render(m, y) {
            const container = document.getElementById('fullCalendar');
            const label = document.getElementById('calMonthLabel');
            const firstDay = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m + 1, 0).getDate();
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            
            label.innerText = `${monthNames[m]} ${y}`;
            const today = new Date(); today.setHours(0,0,0,0);

            let html = `<div class="cal-header"><button class="cal-btn" onclick="changeMonth(-1)"><i class="bi bi-chevron-left"></i></button><div class="flex-grow-1"></div><button class="cal-btn" onclick="changeMonth(1)"><i class="bi bi-chevron-right"></i></button></div>`;
            html += '<div class="cal-grid">';
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(d => html += `<div class="cal-day-head">${d}</div>`);
            for (let i = 0; i < firstDay; i++) html += `<div class="cal-day other-month"></div>`;
            for (let d = 1; d <= daysInMonth; d++) {
                const dateStr = `${y}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                const checkDate = new Date(y, m, d);
                const isSun = checkDate.getDay() === 0;
                const hol = holidays.find(h => h.date === dateStr);
                const isToday = checkDate.getTime() === today.getTime();
                let cls = 'cal-day';
                if (isToday) cls += ' today'; if (hol) cls += ' holiday'; if (isSun) cls += ' sunday';
                html += `<div class="${cls}" title="${hol ? hol.name : ''}"><div class="cal-num">${d}</div>${hol ? `<div class="holiday-indicator"></div>` : ''}${isSun && !hol ? `<div class="off-label">Off</div>` : ''}</div>`;
            }
            container.innerHTML = html + '</div>';
        }

        window.changeMonth = (dir) => {
            month += dir; if (month < 0) { month = 11; year--; } else if (month > 11) { month = 0; year++; }
            render(month, year);
        };
        init();
    });
</script>
{% endblock %}